ClipFarmer

Automatic Short-Form Video Generation Pipeline

Overview

ClipFarmer is an end-to-end video processing system that converts long-form videos into short, vertically cropped clips optimized for short-form platforms (Reels, Shorts, TikTok).

The system automatically:

identifies the most engaging segment of a video using audio intensity,

tracks faces frame-by-frame,

dynamically crops the video to a 9:16 aspect ratio while keeping the subject centered,

preserves the original audio track,

returns a ready-to-publish output clip.

The project is deployed using a FastAPI backend on AWS EC2 and a Next.js frontend on Vercel.

Key Features

Audio-based highlight extraction (loudest segment detection)

Face-aware dynamic cropping

Automatic 16:9 to 9:16 conversion

Smooth center tracking with temporal stabilization

Audio remuxing without re-encoding

Cloud-hosted backend with real video workloads

Web-based frontend for upload and preview

Processing Pipeline
Video Upload
   ↓
Audio Energy Analysis (FFmpeg)
   ↓
Loudest Segment Extraction
   ↓
Frame-by-Frame Face Detection
   ↓
Smoothed Subject Tracking
   ↓
Vertical Cropping (9:16)
   ↓
Audio-Video Remuxing
   ↓
Final Output Video

Architecture
Frontend

Next.js (App Router)

Deployed on Vercel

Handles file selection, preview, and playback

Backend

FastAPI (Python)

Deployed on AWS EC2

Orchestrates video processing and ML inference

Core Technologies

FFmpeg for audio analysis and media remuxing

MediaPipe for face detection

OpenCV for frame manipulation

NumPy for numeric operations

Repository Structure
.
├── main.py          # FastAPI application
├── loudest.py       # Audio-based clip extraction
├── process.py       # Face tracking and cropping
├── tmp/             # Temporary processing directory
├── frontend/        # Next.js frontend
└── README.md

Running Locally
Backend
Requirements

Python 3.10 recommended

FFmpeg installed

Linux, macOS, or WSL

Install dependencies:

pip install fastapi uvicorn mediapipe==0.10.14 opencv-python numpy
sudo apt install ffmpeg libgl1


Run the server:

uvicorn main:app --host 0.0.0.0 --port 8000


API documentation:

http://localhost:8000/docs

Frontend
cd frontend
npm install
npm run dev


Open:

http://localhost:3000

Deployment Notes
Backend (AWS EC2)

Runs as a long-lived service (tmux or systemd)

Designed to handle large video uploads

Performs CPU-intensive processing tasks

Frontend (Vercel)

Used for UI and client interaction

Large file uploads are not routed through Vercel API routes due to size limits

Production setup should use direct backend uploads or object storage (S3 / R2)

Known Constraints

Vercel API routes impose strict payload size limits

MediaPipe is more stable on Python 3.10 than 3.12

Single-worker configuration recommended to avoid FFmpeg race conditions

Future Work

Progress tracking via WebSockets

Multi-clip generation per video

Direct uploads using object storage

Improved multi-face handling

GPU acceleration

Job queue and background workers

Motivation

ClipFarmer is built as a practical system rather than a demo.
It focuses on real-world constraints such as media processing performance, deployment issues, and frontend-backend interaction at scale.

Author

Basit Warsi
Undergraduate, Computer Science
Indian Institute of Technology Jammu

Interests: applied machine learning, video intelligence, backend systems